library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(lubridate)

df <- read_csv("/Users/nishant/Desktop/1-RESEARCH/Data&Code/IHS/IHS Erasmus_2015_2020.csv")
df1<- df%>%
  select(CountryName=`Country-Name`,
         LastAvailableDate=`Last Available Date`,
         MakeGroup = `Make Group`,
         Make,
         ModelGroup=`Model Group`,
         Model, 
         SubGroup=`Sub Model`,
         Version,
         Trim,
         GenerationYear=`Generation Year`,
         FeulType=`Fuel Type`,
         PriceLocal=`Price (local)`,
         "01-01-2015"=`2015/01`,
         "01-02-2015"=`2015/02`,
         "01-03-2015"=`2015/03`,
         "01-04-2015"=`2015/04`,
         "01-05-2015"=`2015/05`,
         "01-06-2015"=`2015/06`,
         "01-07-2015"=`2015/07`,
         "01-08-2015"=`2015/08`,
         "01-09-2015"=`2015/09`,
         "01-10-2015"=`2015/10`,
         "01-11-2015"=`2015/11`,
         "01-12-2015"=`2015/12`,
         "01-01-2016"=`2016/01`,
         "01-02-2016"=`2016/02`,
         "01-03-2016"=`2016/03`,
         "01-04-2016"=`2016/04`,
         "01-05-2016"=`2016/05`,
         "01-06-2016"=`2016/06`,
         "01-07-2016"=`2016/07`,
         "01-08-2016"=`2016/08`,
         "01-09-2016"=`2016/09`,
         "01-10-2016"=`2016/10`,
         "01-11-2016"=`2016/11`,
         "01-12-2016"=`2016/12`,
         "01-01-2017"=`2017/01`,
         "01-02-2017"=`2017/02`,
         "01-03-2017"=`2017/03`,
         "01-04-2017"=`2017/04`,
         "01-05-2017"=`2017/05`,
         "01-06-2017"=`2017/06`,
         "01-07-2017"=`2017/07`,
         "01-08-2017"=`2017/08`,
         "01-09-2017"=`2017/09`,
         "01-10-2017"=`2017/10`,
         "01-11-2017"=`2017/11`,
         "01-12-2017"=`2017/12`,
         "01-01-2018"=`2018/01`,
         "01-02-2018"=`2018/02`,
         "01-03-2018"=`2018/03`,
         "01-04-2018"=`2018/04`,
         "01-05-2018"=`2018/05`,
         "01-06-2018"=`2018/06`,
         "01-07-2018"=`2018/07`,
         "01-08-2018"=`2018/08`,
         "01-09-2018"=`2018/09`,
         "01-10-2018"=`2018/10`,
         "01-11-2018"=`2018/11`,
         "01-12-2018"=`2018/12`,
         "01-01-2019"=`2019/01`,
         "01-02-2019"=`2019/02`,
         "01-03-2019"=`2019/03`,
         "01-04-2019"=`2019/04`,
         "01-05-2019"=`2019/05`,
         "01-06-2019"=`2019/06`,
         "01-07-2019"=`2019/07`,
         "01-08-2019"=`2019/08`,
         "01-09-2019"=`2019/09`,
         "01-10-2019"=`2019/10`,
         "01-11-2019"=`2019/11`,
         "01-12-2019"=`2019/12`,
         "01-01-2020"=`2020/01`,
         "01-02-2020"=`2020/02`,)%>%
  filter(CountryName=="USA")

df2 = gather(df1, Date, NumSold,"01-01-2015":"01-02-2020")
df2$Date=as.Date(df2$Date, format= "%d-%m-%Y")

df3 <- df2%>%
  filter(PriceLocal!="Unspecified")%>%
  group_by(Make= as.factor(Make),Date=as.factor(Date))%>%
  summarise(Sales= sum(NumSold), Price_Avg= mean(as.integer(PriceLocal)))

df3$Date <-as.Date(df3$Date)

write.csv(df3, file="/Users/nishant/Desktop/1-RESEARCH/Data&Code/Z-Final DataSets/IHS_Car Sales/Sales_Data_2015-2020.csv")
  
